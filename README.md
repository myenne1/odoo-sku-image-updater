# Althea Product Scraper & Odoo Integration

This project automates the process of scraping product information and images from an Althea system and uploading them to an Odoo ERP instance.

## Overview

The scraper consists of three main components:
- **Navigator**: Handles browser automation and login to Althea system
- **Scraper**: Extracts product data and downloads images
- **Odoo Uploader**: Uploads product images to Odoo ERP system

## Prerequisites

- Python 3.7+
- Playwright browser automation library
- Access to Althea system credentials
- Odoo instance with API access

## Installation

1. Clone this repository
 ```bash
   git clone https://github.com/myenne1/odoo-sku-image-updater.git
   ```
2. Install required dependencies:
   ```bash
   pip install -r requirements.txt
   ```
3. Install Playwright browsers:
   ```bash
   playwright install chromium
   ```

## Configuration

### Environment Variables Setup

Create a `.env` file in the project root with the following variables:

```env
# Althea System Credentials
ALTHEA_USERNAME=your_althea_username
ALTHEA_PASSWORD=your_althea_password
ALTHEA_LOGIN_URL=https://your-althea-instance.com/login

# Odoo ERP Credentials
ODOO_URL=https://your-odoo-instance.com
ODOO_DB=your_database_name
ODOO_USERNAME=your_odoo_username
ODOO_API_KEY=your_odoo_api_key

# Scraper Configuration
PAGE_LIMIT=100
```

### Finding Your Odoo Credentials

#### Database Name
- Log into your Odoo instance
- Look at the URL: `https://your-db-name.odoo.com/web#...`
- The database name is typically the subdomain before `.odoo.com`
- Or check the URL parameters for `db=database_name`

#### API Key
1. Log into Odoo
2. Click on your profile picture in the top right corner and select "My Profile"
3. Navigate to "Account Security"
4. Scroll down to "API Keys" section
5. Click "New API Key"
6. Give it a description
7. Copy the generated API key

#### Odoo URL
- Use your full Odoo instance URL (e.g., `https://your-company.odoo.com`)
- Do not include `/web` or other path suffixes

## Usage

### Running the Scraper

1. **Start the scraping process:**
   ```bash
   python main.py
   ```

2. **What happens when the scraper runs:**
   - Browser launches and navigates to Althea login page
   - Automatically logs in using provided credentials
   - Navigates to the product database section
   - Pauses and waits for user confirmation to start scraping
   - **User Action Required**: Navigate to the specific page/filters you want to scrape, then press ENTER
   - Scrapes all product pages automatically (up to 100 pages by default)
   - For each product:
     - Extracts SKU and product name
     - Downloads product image (if available)
     - Records data in CSV file

3. **Output Files Created:**
   - **`downloaded-images/`**: Folder containing all downloaded product images
     - Images are saved as `Product-Name.jpg`
     - Base64 encoded images are decoded and saved as JPG files
   - **`meta.csv`**: CSV file with SKU and image path mappings
     - Format: `sku,img_src`
     - Contains path to downloaded image for each SKU
   - **`no_images.txt`**: List of products that had no images available
     - Format: `- Product Name | SKU: SKU123`

### Uploading to Odoo

After scraping is complete, upload images to Odoo:

```bash
python upload_odoo.py meta.csv
```

**What the upload script does:**
- Reads the CSV file generated by the scraper
- For each SKU in the CSV:
  - Searches for the product in Odoo by SKU (default_code field)
  - Reads the corresponding image file
  - Encodes image to base64
  - Updates the product's main image (image_1920 field) in Odoo
- Provides status updates for each upload

## File Structure

```
project/
├── main.py                 # Main execution script
├── navigator.py           # Browser automation and login
├── scraper.py            # Product data extraction
├── upload_odoo.py        # Odoo integration
├── configurations/
│   └── config.py         # Settings management
├── requirements.txt      # Python dependencies
├── .env                 # Environment variables (create this)
├── downloaded-images/   # Downloaded product images (created during run)
├── meta.csv            # SKU to image path mapping (created during run)
└── no_images.txt       # Products without images (created during run)
```

## Important Notes

### Security
- Never commit your `.env` file to version control
- Keep your Odoo API key secure and rotate it regularly
- Use dedicated API user accounts with minimal required permissions

### Scraping Behavior
- The scraper runs in non-headless mode by default so you can see the process
- It automatically handles pagination up to 100 pages
- Each page is fully loaded before processing (waits for network idle)
- Products without images are logged but not uploaded to Odoo

### Error Handling
- Failed image downloads are logged but don't stop the process
- Missing products in Odoo are reported but don't stop the upload
- All errors are logged with descriptive messages

### Performance
- The scraper includes delays between page navigation for stability
- Large image collections may take significant time to process
- Monitor your Odoo instance for API rate limits during upload

## Troubleshooting

### Common Issues

1. **Login fails**: Verify Althea credentials in `.env` file
2. **Odoo authentication fails**: Check Odoo URL, database name, username, and API key
3. **Images not found**: Some products may not have images in the source system
4. **Upload fails**: Ensure SKUs in CSV match exactly with Odoo product codes

### Support
- Check console output for detailed error messages
- Verify all credentials are correctly configured
- Ensure Playwright browsers are installed: `playwright install chromium`